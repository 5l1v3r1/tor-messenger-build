# HG changeset patch
# User Sukhbir Singh <sukhbir@torproject.org>
# Date 1416649788 18000
# Node ID 84423e51b0535ccd21aff64f10176f3e8c05b7c3
# Parent  ae1c9811a808a4c642d97bf9202cb7bfb866f6b1
Update the security configuration preferences

diff --git a/im/app/profile/all-instantbird.js b/im/app/profile/all-instantbird.js
--- a/im/app/profile/all-instantbird.js
+++ b/im/app/profile/all-instantbird.js
@@ -3,18 +3,16 @@
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 pref("toolkit.defaultChromeURI", "chrome://instantbird/content/blist.xul");
 pref("toolkit.singletonWindowType", "Messenger:blist");
 #ifdef XP_MACOSX
 pref("browser.hiddenWindowChromeURL", "chrome://instantbird/content/hiddenWindow.xul");
 #endif
 
-#expand pref("general.useragent.extra.instantbird", "Instantbird/__APP_VERSION__");
-
 #ifdef XP_UNIX
 #ifndef XP_MACOSX
 #define UNIX_BUT_NOT_MAC
 #endif
 #endif
 
 pref("general.smoothScroll", false);
 #ifdef UNIX_BUT_NOT_MAC
@@ -112,24 +110,16 @@ pref("browser.preferences.animateFadeIn"
 pref("browser.zoom.full", true);
 pref("conversation.zoomLevel", "1.0");
 
 pref("accessibility.typeaheadfind", false);
 pref("accessibility.typeaheadfind.timeout", 5000);
 pref("accessibility.typeaheadfind.linksonly", false);
 pref("accessibility.typeaheadfind.flashBar", 1);
 
-// Whether or not app updates are enabled
-pref("app.update.enabled", true);
-
-// This preference turns on app.update.mode and allows automatic download and
-// install to take place. We use a separate boolean toggle for this to make
-// the UI easier to construct.
-pref("app.update.auto", true);
-
 // Defines how the Application Update Service notifies the user about updates:
 //
 // AUM Set to:        Minor Releases:     Major Releases:
 // 0                  download no prompt  download no prompt
 // 1                  download no prompt  download no prompt if no incompatibilities
 // 2                  download no prompt  prompt
 //
 // See chart in nsUpdateService.js.in for more details
@@ -197,17 +187,17 @@ pref("browser.search.defaultenginename",
 // disable logging for the search service by default
 pref("browser.search.log", false);
 
 // Ordering of Search Engines in the Engine list.
 pref("browser.search.order.1",                "chrome://instantbird/locale/region.properties");
 pref("browser.search.order.2",                "chrome://instantbird/locale/region.properties");
 
 // send ping to the server to update
-pref("browser.search.update", true);
+pref("browser.search.update", false);
 
 // disable logging for the search service update system by default
 pref("browser.search.update.log", false);
 
 // Check whether we need to perform engine updates every 6 hours
 pref("browser.search.updateinterval", 6);
 
 /* Extension manager */
@@ -217,20 +207,18 @@ pref("xpinstall.dialog.progress.chrome",
 pref("xpinstall.dialog.progress.type.skin", "Extension:Manager");
 pref("xpinstall.dialog.progress.type.chrome", "Extension:Manager");
 pref("extensions.dss.enabled", false);
 pref("extensions.dss.switchPending", false);
 pref("extensions.ignoreMTimeChanges", false);
 pref("extensions.logging.enabled", false);
 pref("general.skins.selectedSkin", "classic/1.0");
 
-pref("extensions.update.enabled", true);
 pref("extensions.update.interval", 86400);
 pref("extensions.update.url", "https://addons.instantbird.org/services/update.php?reqVersion=%REQ_VERSION%&id=%ITEM_ID%&version=%ITEM_VERSION%&maxAppVersion=%ITEM_MAXAPPVERSION%&status=%ITEM_STATUS%&appID=%APP_ID%&appVersion=%APP_VERSION%&appOS=%APP_OS%&appABI=%APP_ABI%&locale=%APP_LOCALE%");
-pref("extensions.update.autoUpdateDefault", true);
 
 // Preferences for the Get Add-ons pane
 pref("extensions.getAddons.cache.enabled", false);
 pref("extensions.getAddons.browseAddons", "https://addons.instantbird.org/%LOCALE%/%APP%");
 pref("extensions.getAddons.maxResults", 5);
 pref("extensions.getAddons.recommended.browseURL", "https://addons.instantbird.org/%LOCALE%/%APP%/recommended");
 pref("extensions.getAddons.recommended.url", "https://services.instantbird.org/%LOCALE%/%APP%/api/%API_VERSION%/list/featured/all/10/%OS%/%VERSION%");
 pref("extensions.getAddons.search.browseURL", "https://add-ons.instantbird.org/%LOCALE%/%APP%/search?q=%TERMS%");
@@ -239,21 +227,16 @@ pref("extensions.webservice.discoverURL"
 
 pref("extensions.getMoreExtensionsURL", "https://add-ons.instantbird.org/%LOCALE%/%APP%/%VERSION%/extensions/");
 pref("extensions.getMoreThemesURL", "https://add-ons.instantbird.org/%LOCALE%/%APP%/%VERSION%/themes/");
 pref("extensions.getMorePluginsURL", "https://add-ons.instantbird.org/%LOCALE%/%APP%/%VERSION%/plugins/");
 pref("extensions.getMoreMessageStylesURL", "https://add-ons.instantbird.org/%LOCALE%/%APP%/%VERSION%/messagestyles/");
 pref("extensions.getMoreEmoticonsURL", "https://add-ons.instantbird.org/%LOCALE%/%APP%/%VERSION%/emoticons/");
 pref("extensions.getMoreProtocolsURL", "https://add-ons.instantbird.org/%LOCALE%/%APP%/%VERSION%/protocols/");
 
-// suppress external-load warning for standard browser schemes
-pref("network.protocol-handler.warn-external.http", false);
-pref("network.protocol-handler.warn-external.https", false);
-pref("network.protocol-handler.warn-external.ftp", false);
-
 // don't load links inside Instantbird
 pref("network.protocol-handler.expose-all", false);
 // Although we allow these to be exposed internally, there are various places
 // (e.g. message pane) where we may divert them out to external applications.
 pref("network.protocol-handler.expose.about", true);
 pref("network.protocol-handler.expose.http", true);
 pref("network.protocol-handler.expose.https", true);
 
@@ -297,19 +280,86 @@ pref("browser.tabs.tabClipWidth", 140);
 
 // Where to show tab close buttons:
 // 0  on active tab only
 // 1  on all tabs until tabClipWidth is reached, then active tab only
 // 2  no close buttons at all
 // 3  at the end of the tabstrip
 pref("browser.tabs.closeButtons", 1);
 
-#expand pref("chat.irc.defaultQuitMessage", "Instantbird __APP_VERSION__ -- http://www.instantbird.com");
-
 pref("chat.twitter.consumerKey", "TSuyS1ieRAkB3qWv8yyEw");
 pref("chat.twitter.consumerSecret", "DKtKaSf5a7pBNhdBsSZHTnI5Y03hRlPFYWmb4xXBlkU");
 
 // Comma separated list of prpl ids that should use libpurple even if there is
 // a JS implementation. This is used to land JS-prpls pref'ed off in nightlies.
-pref("chat.prpls.forcePurple", "prpl-jabber");
+pref("chat.prpls.forcePurple", "");
 
 // Whether to parse log files for conversation statistics.
 pref("statsService.parseLogsForStats", true);
+
+/* Tor Messenger */
+// Logging
+// Disable all logging
+pref("purple.logging.format", "json");
+pref("purple.logging.log_chats", false);
+pref("purple.logging.log_ims", false);
+pref("purple.logging.log_system", false);
+
+// Network
+// Use a manual proxy configuration
+pref("network.proxy.type", 1);
+// Configure Instantbird to use the SOCKS5 proxy
+pref("network.proxy.socks", "127.0.0.1");
+pref("network.proxy.socks_port", 9152);
+pref("network.proxy.socks_version", 5);
+// Set DNS proxying through SOCKS5
+pref("network.proxy.socks_remote_dns", true);
+// Warn when an external application is to be launched
+pref("network.protocol-handler.warn-external.http", true);
+pref("network.protocol-handler.warn-external.https", true);
+pref("network.protocol-handler.warn-external.ftp", true);
+pref("network.protocol-handler.warn-external.file", true);
+pref("network.protocol-handler.warn-external-default", true);
+
+// Security
+// Disable SSLv3 by setting the minimum supported protocol to TLS 1.0.
+pref("security.tls.version.min", 1);
+// Disable geolocation
+pref("geo.enabled", false);
+// Empty the user agent
+pref("general.useragent.extra.instantbird", "");
+
+// Messenger
+//  0 = do not connect / show the account manager
+pref("messenger.startup.action", 0);
+// Do not report idle status or the away message
+pref("messenger.status.awayWhenIdle", false);
+pref("messenger.status.defaultIdleAwayMessage", "");
+pref("messenger.status.reportIdle", false);
+// Do not play sounds on messaging events
+pref("messenger.options.playSounds.message", false);
+
+// Chat
+// Do not show any quit message
+pref("chat.irc.defaultQuitMessage", "");
+
+// Browser
+// Disable caching
+pref("browser.cache.disk.enable", false);
+pref("browser.cache.offline.enable", false);
+// Disable text formatting (remove the tags)
+pref("messenger.options.filterMode", 0);
+
+// Media
+// Disable "Take Picture" functionality that accesses the webcam
+pref("media.navigator.video.enabled", false);
+
+// Enable cert pinning
+// 2. Strict. Pinning is always enforced
+pref("security.cert_pinning.enforcement_level", 2);
+
+// Updates
+// Do not auto-update Instantbird
+pref("app.update.enabled", false):
+pref("app.update.auto", false);
+// Do not auto-update extensions
+pref("extensions.update.enabled", false);
+pref("extensions.update.autoUpdateDefault", false);
